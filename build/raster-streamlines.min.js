!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).rastertools={})}(this,function(t){"use strict";function y(t,e){if(t.length<=1||e.length<=1||t[0].length<=1||e[0].length<=1)throw new Error("Raster is too small");if(t.length!==e.length||t[0].length!==e[0].length)throw new Error("Raster components are not the same shape");this.uData=t,this.vData=e,this.xSize=this.uData[0].length,this.ySize=this.uData.length,this.usedPixels=new Array(this.ySize);for(var i=0;i<this.ySize;i++)this.usedPixels[i]=new Array(this.xSize).fill(!1)}function u(t,e,i){return t<=e?e:i<=t?i:t}y.prototype.isPixelFree=function(t,e,i){if(t<0||t>=this.xSize||e<0||e>=this.ySize)return!1;for(var s=Math.max(t-i,0),r=Math.min(t+i,this.xSize-1),a=Math.max(e-i,0),n=Math.min(e+i,this.ySize-1),h=s;h<=r;h++)for(var o=a;o<=n;o++)if(this.usedPixels[o][h])return!1;return!0},y.prototype.getLine=function(t,e,i){if(t<0||e<0||t>=this.xSize||e>=this.ySize||this.usedPixels[e][t])return!1;var s,r,a,n,h,o=!1,u=[[t,e]];for(i=i?1:-1,s=t,r=e;;){if(0===(h=this.getValueAtPoint(s,r)).u&&0===h.v){this.usedPixels[e][t]=!0;break}if(s+=h.u,r+=i*h.v,n=Math.round(r),(a=Math.round(s))<0||n<0||a>=this.xSize||n>=this.ySize||this.usedPixels[n][a])break;u.push([s,r]),o=!0,this.usedPixels[n][a]=!0}for(s=t,r=e;;){if(0===(h=this.getValueAtPoint(s,r)).u&&0===h.v){this.usedPixels[e][t]=!0;break}if(s-=h.u,r-=i*h.v,n=Math.round(r),(a=Math.round(s))<0||n<0||a>=this.xSize||n>=this.ySize||this.usedPixels[n][a])break;u.unshift([s,r]),o=!0,this.usedPixels[n][a]=!0}return!!o&&(this.usedPixels[e][t]=!0,u)},y.prototype.applyGeoTransform=function(t,e){return null==e?t:t.map(function(t){return[e[0]+e[1]*t[0]+e[2]*t[1],e[3]+e[4]*t[0]+e[5]*t[1]]})},y.prototype.getValueAtPoint=function(t,e){var i=u(Math.floor(t),0,this.xSize-2),s=i+1,r=u(Math.floor(e),0,this.ySize-2),a=r+1,n=t-i,h=1-n,o=e-r,t=1-o,e=t*h,h=o*h,t=t*n,o=o*n,n=this.uData[r][i]*e+this.uData[r][s]*h+this.uData[a][i]*t+this.uData[a][s]*o,s=this.vData[r][i]*e+this.vData[r][s]*h+this.vData[a][i]*t+this.vData[a][s]*o,o=Math.max(Math.abs(n),Math.abs(s))||1;return{u:n/o,v:s/o}},t.streamlines=function(t,e,i,s,r){s=s||1;var a={type:"FeatureCollection",features:[]},n=0,h=new y(t,e);if(i&&6!==i.length)throw new Error("Bad geotransform");for(var o=Math.round(h.ySize/(60*s))||1,u=h.xSize*h.ySize,l=0;l<u;l++){var f=327685*l%u,p=Math.trunc(f/h.ySize),f=f%h.ySize;!h.isPixelFree(p,f,o)||(f=h.getLine(p,f,r))&&(a.features.push({type:"Feature",geometry:{type:"LineString",coordinates:h.applyGeoTransform(f,i)},properties:{num_line:n}}),n++)}return a},Object.defineProperty(t,"__esModule",{value:!0})});